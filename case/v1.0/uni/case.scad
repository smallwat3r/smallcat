// Smallcat Unibody Keyboard Case
// Tray-style case design
// PCB outline extracted from KiCad

include <../common.scad>

// USB-C cutout parameters
usb_width = 17;            // controller width with clearance
usb_height = 4;            // controller height with clearance
usb_x_position = 100;      // X position of USB port center (middle top)

// PCB outline points (extracted from KiCad)
pcb_outline = [
    [144.285, 64.538],
    [142.599, 64.914],
    [142.385, 64.897],
    [142.181, 64.832],
    [141.997, 64.723],
    [141.842, 64.576],
    [141.724, 64.397],
    [141.649, 64.197],
    [141.286, 62.199],
    [141.266, 61.798],
    [141.349, 61.406],
    [141.529, 61.048],
    [141.795, 60.748],
    [142.129, 60.526],
    [142.509, 60.397],
    [145.394, 59.501],
    [145.740, 59.341],
    [146.033, 59.098],
    [146.255, 58.789],
    [146.391, 58.433],
    [146.432, 58.054],
    [146.374, 57.677],
    [145.600, 55.123],
    [145.579, 54.731],
    [145.658, 54.346],
    [145.832, 53.994],
    [146.090, 53.697],
    [146.413, 53.475],
    [146.783, 53.342],
    [160.966, 49.565],
    [161.358, 49.545],
    [161.743, 49.624],
    [162.095, 49.798],
    [162.392, 50.055],
    [162.614, 50.379],
    [162.747, 50.748],
    [163.253, 53.156],
    [163.386, 53.526],
    [163.608, 53.849],
    [163.905, 54.106],
    [164.257, 54.280],
    [164.642, 54.360],
    [165.034, 54.339],
    [179.847, 51.199],
    [180.211, 51.062],
    [180.528, 50.838],
    [180.779, 50.543],
    [180.949, 50.193],
    [181.026, 49.813],
    [181.005, 49.425],
    [179.480, 42.271],
    [179.447, 41.797],
    [179.540, 41.330],
    [179.752, 40.905],
    [180.069, 40.550],
    [180.468, 40.292],
    [180.921, 40.147],
    [198.062, 38.050],
    [198.517, 37.934],
    [198.928, 37.707],
    [199.269, 37.384],
    [199.517, 36.986],
    [199.657, 36.538],
    [199.679, 36.069],
    [198.057, 22.654],
    [197.941, 22.199],
    [197.715, 21.788],
    [197.392, 21.447],
    [196.993, 21.199],
    [196.545, 21.059],
    [196.076, 21.037],
    [177.253, 23.388],
    [176.787, 23.417],
    [176.329, 23.323],
    [175.912, 23.113],
    [175.563, 22.802],
    [175.308, 22.411],
    [175.163, 21.967],
    [171.033, 2.389],
    [170.864, 1.947],
    [170.585, 1.565],
    [170.216, 1.269],
    [169.781, 1.081],
    [169.313, 1.013],
    [168.844, 1.071],
    [152.371, 4.537],
    [151.924, 4.567],
    [151.485, 4.483],
    [151.081, 4.292],
    [150.737, 4.006],
    [150.476, 3.643],
    [150.314, 3.226],
    [149.825, 1.369],
    [149.651, 0.918],
    [149.362, 0.531],
    [148.979, 0.236],
    [148.531, 0.055],
    [148.051, 0.001],
    [147.574, 0.078],
    [133.589, 3.825],
    [133.358, 3.900],
    [133.138, 4.005],
    [132.936, 4.140],
    [132.753, 4.301],
    [132.594, 4.486],
    [132.462, 4.691],
    [67.261, 4.705],
    [67.125, 4.493],
    [66.960, 4.303],
    [66.771, 4.138],
    [66.559, 4.002],
    [66.331, 3.896],
    [66.090, 3.824],
    [52.105, 0.077],
    [51.628, 0.000],
    [51.148, 0.054],
    [50.700, 0.235],
    [50.318, 0.531],
    [50.029, 0.918],
    [49.855, 1.368],
    [49.365, 3.226],
    [49.204, 3.643],
    [48.943, 4.006],
    [48.599, 4.292],
    [48.194, 4.483],
    [47.755, 4.566],
    [47.309, 4.537],
    [30.836, 1.070],
    [30.366, 1.012],
    [29.898, 1.080],
    [29.464, 1.268],
    [29.094, 1.564],
    [28.815, 1.946],
    [28.646, 2.388],
    [24.516, 21.966],
    [24.371, 22.410],
    [24.116, 22.801],
    [23.768, 23.112],
    [23.350, 23.322],
    [22.893, 23.416],
    [22.427, 23.388],
    [3.603, 21.036],
    [3.134, 21.059],
    [2.686, 21.198],
    [2.288, 21.447],
    [1.965, 21.787],
    [1.738, 22.198],
    [1.622, 22.653],
    [0.000, 36.068],
    [0.022, 36.537],
    [0.162, 36.985],
    [0.410, 37.384],
    [0.751, 37.707],
    [1.162, 37.933],
    [1.617, 38.049],
    [18.758, 40.146],
    [19.211, 40.291],
    [19.610, 40.550],
    [19.927, 40.904],
    [20.140, 41.330],
    [20.233, 41.796],
    [20.200, 42.271],
    [18.675, 49.425],
    [18.654, 49.812],
    [18.731, 50.193],
    [18.900, 50.542],
    [19.151, 50.838],
    [19.469, 51.061],
    [19.832, 51.198],
    [34.645, 54.339],
    [35.038, 54.359],
    [35.422, 54.280],
    [35.774, 54.106],
    [36.071, 53.849],
    [36.294, 53.525],
    [36.427, 53.155],
    [36.932, 50.748],
    [37.065, 50.378],
    [37.287, 50.054],
    [37.584, 49.797],
    [37.936, 49.623],
    [38.321, 49.544],
    [38.713, 49.564],
    [52.897, 53.341],
    [53.266, 53.475],
    [53.590, 53.697],
    [53.847, 53.994],
    [54.021, 54.346],
    [54.100, 54.730],
    [54.080, 55.123],
    [53.305, 57.677],
    [53.242, 58.057],
    [53.279, 58.440],
    [53.413, 58.801],
    [53.635, 59.115],
    [53.931, 59.362],
    [54.280, 59.524],
    [57.166, 60.418],
    [57.546, 60.547],
    [57.880, 60.769],
    [58.146, 61.069],
    [58.326, 61.427],
    [58.409, 61.819],
    [58.389, 62.220],
    [58.026, 64.218],
    [57.951, 64.418],
    [57.833, 64.597],
    [57.678, 64.744],
    [57.494, 64.853],
    [57.290, 64.918],
    [57.076, 64.935],
    [55.390, 64.559],
    [54.991, 64.526],
    [54.598, 64.597],
    [54.236, 64.768],
    [53.931, 65.025],
    [53.702, 65.353],
    [53.565, 65.728],
    [50.668, 79.407],
    [50.636, 79.805],
    [50.707, 80.199],
    [50.877, 80.560],
    [51.135, 80.866],
    [51.462, 81.095],
    [51.838, 81.231],
    [67.835, 84.644],
    [66.482, 86.845],
    [66.306, 87.203],
    [66.231, 87.596],
    [66.261, 87.995],
    [66.394, 88.371],
    [66.622, 88.700],
    [66.928, 88.957],
    [79.662, 96.902],
    [80.028, 97.080],
    [80.429, 97.152],
    [80.834, 97.113],
    [81.213, 96.966],
    [81.539, 96.722],
    [81.787, 96.400],
    [89.856, 83.518],
    [109.819, 83.497],
    [117.888, 96.379],
    [118.136, 96.701],
    [118.462, 96.945],
    [118.841, 97.092],
    [119.246, 97.131],
    [119.647, 97.059],
    [120.013, 96.881],
    [132.747, 88.936],
    [133.053, 88.679],
    [133.281, 88.351],
    [133.414, 87.974],
    [133.444, 87.575],
    [133.369, 87.182],
    [133.193, 86.824],
    [131.840, 84.623],
    [147.837, 81.210],
    [148.213, 81.074],
    [148.540, 80.845],
    [148.798, 80.539],
    [148.968, 80.178],
    [149.039, 79.784],
    [149.007, 79.386],
    [146.110, 65.707],
    [145.973, 65.332],
    [145.744, 65.004],
    [145.439, 64.747],
    [145.077, 64.576],
    [144.684, 64.505]
];

// USB-C cutout module (on back/top edge, Y near 0)
// Also removes base plate so it stops before the border
module usb_cutout() {
    e = 0.01;  // Epsilon to avoid coincident faces
    cutout_depth = wall_thickness + pcb_clearance + 2.8;
    translate([usb_x_position - usb_width/2 - e, -5, -e])
        cube([usb_width + 2*e, cutout_depth + 5 + e, case_depth + 2*e]);
}

// Render the case
case_bottom(pcb_outline) {
    usb_cutout();
}
